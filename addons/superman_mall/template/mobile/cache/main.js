$(function(){'use strict';var loadCountdown=function(classname){$.timer.clear($.timer.countDownIds);if($('.countdown').length){$('.countdown').html('-时-分-秒');}
var obj=$('.'+classname);if(obj.length){obj.each(function(){var t=this;var time=parseInt($(t).attr('data-time'));if(time<((new Date).getTime()/1000)){obj.parent().remove();return;}
var timerId=setInterval(function(){var ret=$.timer.run(time,t);if(!ret){$.timer.clear($(t).attr('data-timerid'));}},1000);$(t).attr('data-timerid',timerId);$.timer.countDownIds.push(timerId);});}};var ItemSpecHtml='';var initItemPage=function(page){superman.log('ItemSku: '+$.dump(ItemSku),'debug');ItemSpecHtml=$('.item_spec_wrap',page).html().replace('__item_spec','item_spec');$('.full_cut_info',page).click(function(){if($(this).parent().hasClass('text-overflow')){$(this).parent().removeClass('text-overflow');}else{$(this).parent().addClass('text-overflow');}});$.ajax({url:$(page).attr('data-view-url'),success:function(response){superman.log('item page view: ok','debug');}});sharedata.success=function(){if($('.wechat_share_tips',page).length){$.overlay.toggle('',false);}
$.ajax({url:$(page).attr('data-share-url'),success:function(response){superman.log('item share: ok','debug');}});};$('.follow_link',page).click(function(){$.showIndicator();var t=this;var url=$(this).attr('data-url');var itemid=$(this).attr('data-itemid');var status=$(this).attr('data-status')==1?0:1;$.ajax({url:url,type:'post',data:'itemid='+itemid+'&status='+status,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$(t).attr('data-status',status);if(status==1){$.toast('关注成功');$('.iconfont',t).addClass('color-danger').html('&#xe62e;');$('.tab-label',t).addClass('color-danger').html('已关注');}else{$.toast('取消关注');$('.iconfont',t).removeClass('color-danger').html('&#xe62f;');$('.tab-label',t).removeClass('color-danger').html('关注');}}else if(resp.errno==4){if(resp.errmsg){$.toast(resp.errmsg);}
setTimeout(function(){$.showIndicator();if(resp.data.url){window.location.href=resp.data.url;}else{window.location.href=window.sysinfo.loginurl;}},2000);}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});});var ItemSpec={show:function(type){$.overlay.toggle();if(!$('.item_spec').length){$(document.body).append(ItemSpecHtml);ItemSpecInit(type);}
var single_price=$('.single_price').attr('data-price');var multi_member_join=$('.multi_member_join').attr('data-price');if(type=='single_price'){$('.item_spec .sku_price').html(single_price);}else if(type=='multi_member_join'){$('.item_spec .sku_price').html(multi_member_join);}
$('.item_spec').removeClass('modal-out').addClass('modal-in');},hide:function(){$.overlay.toggle();$('.item_spec').removeClass('modal-in').addClass('modal-out').remove();}};var updateSelectItemSpec=function(){var values=[];$('.item_spec .item_value').each(function(){if($(this).hasClass('active')){var attr=$('.item-title',$(this).parent()).text();values.push(attr+':'+$(this).text());}});$('.spec',page).html(values.join(' '));};var checkItemSpecTotal=function(total){var valueids=[];$('.item_spec .item_value').each(function(){if($(this).hasClass('active')){valueids.push(parseInt($(this).attr('data-id')));}});valueids.sort(function(a,b){return a>b?1:-1});valueids=valueids.join();if(ItemSku!==undefined&&ItemSpec.length){var sku=ItemSku[valueids];if(sku.total<total){return false;}}
return true;};var ItemSpecInit=function(){$('.item_spec .close').click(function(){ItemSpec.hide();});$('.item_spec .item_value').click(function(){if($(this).hasClass('active')){return;}
$('.item_value',$(this).parent()).each(function(){$(this).removeClass('active');});$(this).addClass('active');var valueids=[];$('.item_spec .item_value').each(function(){if($(this).hasClass('active')){valueids.push(parseInt($(this).attr('data-id')));}});valueids.sort(function(a,b){return a>b?1:-1});valueids=valueids.join();superman.log('valueids: '+valueids,'debug');$('.item_spec input[name=valueids]').val(valueids);if(ItemSku!==undefined){var sku=ItemSku[valueids];if(sku.total>0){$('.btn_confirm').removeClass('disabled no_click')}else{$('.btn_confirm').addClass('disabled no_click')}
$('.item_spec .sku_total').html(sku.total);$('.item_spec .sku_price').html(sku.price);$('.btn_plus').attr('data-max-total',sku.total);$('.item_spec input[name=skuid]').val(sku.id);superman.log('sku: '+$.dump(sku),'debug');}});$('.btn_confirm').click(function(){var t=this;$(t).addClass('disabled');$.showIndicator();var skuid=$('.item_spec input[name=skuid]').val();var itemid=$(t).attr('data-itemid');var total=$('.item_spec input[name=total]').val();var max_buy_num=$(t).attr('data-max-buy-num');var order_buy_num=$(t).attr('data-order-buy-num');var buy_sum=$(t).attr('data-buy-sum');if(order_buy_num>0&&total>order_buy_num){$.toast('超过购买件数限制');$(t).removeClass('disabled');$.hideIndicator();return;}
if(max_buy_num>0&&parseInt(total)+parseInt(buy_sum)>max_buy_num){$.toast('超过购买件数限制');$(t).removeClass('disabled');$.hideIndicator();return;}
var type=$(t).attr('data-type');var url=$(t).attr('data-'+type+'-url');var mg=$(t).attr('data-mg');var postdata='itemid='+itemid+'&skuid='+skuid+'&total='+total;if(!checkItemSpecTotal(total)){$.toast('库存不足');$(t).removeClass('disabled');$.hideIndicator();ItemSpec.hide();return;}
updateSelectItemSpec();if(type=='buy'){if(mg=='single'){window.location.href=url+'&single=1&'+postdata+'&__t='+(new Date()).getTime();return;}else if(mg=='new'){$.fn.cookie(window.sysinfo.cookie.pre+'__mgroupon_id','',{expires:-1});}
window.location.href=url+'&'+postdata+'&__t='+(new Date()).getTime();return;}
if(type=='select'){$(t).removeClass('disabled');$.hideIndicator();ItemSpec.hide();return;}
$.ajax({url:url,type:'post',data:postdata,dataType:'json',success:function(resp){$(t).removeClass('disabled');$.hideIndicator();if(resp.errno==0){$.toast('添加成功');ItemSpec.hide();$.updateCartCorner(page,'+',1);}else if(resp.errno==4){if(resp.errmsg){$.toast(resp.errmsg);}
setTimeout(function(){$.showIndicator();if(resp.data.url){window.location.href=resp.data.url;}else{window.location.href=window.sysinfo.loginurl;}},2000);}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});});$('.btn_minus').click(function(){var total=$(this).next().val();var min_total=$(this).attr('data-min-total');total=parseInt(total)-1;if(total<min_total){$.toast($(this).attr('data-title'));return false;}
$(this).next().val(total);return false;});$('.btn_plus').click(function(){var total=$(this).prev().val();var max_total=$(this).attr('data-max-total');total=parseInt(total)+1;if(total>max_total){$.toast($(this).attr('data-title'));return false;}
$(this).prev().val(total);return false;});};if($('.select_item_spec',page).length){$('.select_item_spec',page).click(function(){ItemSpec.show();$('.btn_confirm').attr('data-type','select');});}
$('.add_cart',page).click(function(){ItemSpec.show();$('.btn_confirm').attr('data-type','cart');return false;});$('.buy_item',page).click(function(){ItemSpec.show();$('.btn_confirm').attr('data-type','buy');return false;});$('.single_price',page).click(function(){ItemSpec.show('single_price');$('.btn_confirm').attr('data-type','buy').attr('data-mg','single');return false;});$('.multi_member_join',page).click(function(){ItemSpec.show('multi_member_join');$('.btn_confirm').attr('data-type','buy').attr('data-mg','join');return false;});$('.multi_member_new',page).click(function(){ItemSpec.show();$('.btn_confirm').attr('data-type','buy').attr('data-mg','new');return false;});function addItems(data){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<li>';html+='<a href="#" class="item-content">';html+='   <div class="item-inner">';html+='       <div class="item-title-row">';html+='           <div class="item-title color-danger">';html+='           '+item['star'];html+='           </div>';html+='           <div class="item-after font6">';html+='               <span>';html+='               '+item['member']['nickname'];html+='               </span>&nbsp;&nbsp;';html+='               <span>'+item['dateline']+'</span>';html+='           </div>';html+='       </div>';html+='       <div class="item-subtitle color-default">'+item['message']+'</div>';if(item['imglist']){html+='<div class="row share_img_wrap">';for(var j=0;j<item['imglist'].length;j++){html+='<div class="col-33">';html+='<img src="'+tomedia(item['imglist'][j]['thumb'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';html+='</div>';}
html+='</div>';}
html+='   </div>';html+='</a>';html+='</li>';}
$('.comment_list ul',page).append(html);}
$('.more_comment',page).click(function(){var t=this;if($(t).hasClass('disabled')){return;}
$(t).addClass('disabled');var pagesize=$(t).attr('data-pagesize');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).removeClass('disabled');if(response.length>0){if(response.length<pagesize){$(t).hide();$('.nodata',page).show();}
addItems(response);$(t).attr('data-page',pageno);$.refreshScroller();}else{$(t).hide();$('.nodata',page).show();}}});return false;});};$(document).on('pageInit',".superpage_detail",function(e,id,page){superman.log('['+id+'] pageInit','info');$.wxMenu.show();loadCountdown('seckill_remain_time');initItemPage(page);});$(document).on('pageReinit',".superpage_detail",function(e,id,page){superman.log('['+id+'] pageReinit','info');loadCountdown('seckill_remain_time');initItemPage(page);});});;$(function(){'use strict';$(document).on('pageInit',".superpage_profile",function(e,id,page){superman.log('['+id+'] pageInit','info');var localIds;$('.myavatar_wrap',page).click(function(){var t=this;if(window.sysinfo.container=='wechat'){wx.chooseImage({count:1,sizeType:['original','compressed'],sourceType:['album','camera'],success:function(res){localIds=res.localIds;$('img',t).attr('src',localIds);}});}else{$.toast('请在微信中上传头像');}});$('.myavatar_wrap img',page).click(function(event){$.popup('.popup_big_avatar');event.stopPropagation();});$('.popup_big_avatar',page).click(function(){$.closeModal('.popup_big_avatar');});var saveMemberInfo=function(){var serverId=$('#serverId',page).val();var mobile=$('#mobile',page).val();var nickname=$('#nickname',page).val();var realname=$('#realname',page).val();var email=$('#email',page).val();var token=$('input[name=token]').val();var url=window.location.href;$.ajax({type:'post',data:'serverId='+serverId+'&mobile='+mobile+'&email='+email+'&nickname='+nickname+'&realname='+realname+'&token='+token+'&submit=yes',dataType:'json',url:url,success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast('保存成功，跳转中...');if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{$('input[name=submit]',page).removeClass('disabled').removeAttr('disabled');$.toast(resp.errmsg);}}});};$('input[name=submit]',page).click(function(){$.showIndicator();var t=this;$(t).addClass('disabled').attr('disabled',true);var mobile=$('#mobile',page).val();var email=$('#email',page).val();if(mobile!=''){if(!/^1\d{10}$/.test(mobile)){$.hideIndicator();$.toast('请输入合法的手机号');$(t).removeClass('disabled').removeAttr('disabled');return false;}}
if(email!=''){if(!/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(email)){$.hideIndicator();$.toast('请输入合法邮箱');$(t).removeClass('disabled').removeAttr('disabled');return false;}}
try{if(localIds.length>0){wx.uploadImage({localId:localIds[0],isShowProgressTips:0,success:function(res){var serverId=res.serverId;$('#serverId',page).val(serverId);saveMemberInfo();},fail:function(res){$.alert(JSON.stringify(res));}});}else{saveMemberInfo();}}catch(e){saveMemberInfo();}});});});;$(function(){'use strict';var loadCountdown=function(classname){$.timer.clear($.timer.countDownIds);if($('.countdown').length){$('.countdown').html('-:-:-:');}
var obj=$('.'+classname);if(obj.length){obj.each(function(){var t=this;var time=parseInt($(t).attr('data-time'));if(time<((new Date).getTime()/1000)){$.showIndicator();$.timer.clear($.timer.countDownIds);$.timer.clear($(t).attr('data-timerid'));setTimeout(function(){window.location.reload();},1000);return false;}
var timerId=setInterval(function(){var ret=$.timer.run(time);if(!ret){$.timer.clear($(t).attr('data-timerid'));return false;}
$(t).html('<span>'+ret.hour+'</span>:<span>'+ret.minute+'</span>:<span>'+ret.second+'</span>');},1000);$(t).attr('data-timerid',timerId);$.timer.countDownIds.push(timerId);});}};var initRecommendItem=function(page){$('.style_switch_btn',page).bind('click',function(){var key=window.sysinfo.cookie.pre+'list_style';var list_style=$('.recommend_item_list',page).attr('data-list-style');if(list_style==1){$.fn.cookie(key,'2',{expires:3650});}else{$.fn.cookie(key,'1',{expires:3650});}});var recommend_bar_height=$('.recommend_bar',page).height();var item_list_height=$('.item_list_row',page).height();var recommend_total_height=recommend_bar_height+item_list_height;var bottom_nav_height=$('.bar-tab',page).height();$('.content',page).on('scroll',function(){if($(window).height()-$('.recommend_item',page).offset().top-bottom_nav_height>recommend_total_height){$('.home_search_style2',page).show();$('.home_search_style1',page).hide();}else{$('.home_search_style1',page).show();$('.home_search_style2',page).hide();}});$('.content',page).trigger('scroll');};$(document).on('pageInit',".superpage_home",function(e,id,page){superman.log('['+id+'] pageInit','info');$.wxMenu.show();$('.lazyload',page).picLazyLoad({element:$('.content',page),threshold:100});loadCountdown('seckill_countdown');initRecommendItem(page);function addItems(data,params){var html='',item,price=0.00;var list_style=$('.recommend_item_list',page).attr('data-list-style');var list_style_cart_btn=$('.recommend_item_list',page).attr('data-list-style-cart-btn');if(list_style==1){for(var i=0;i<data.length;i++){item=data[i];if(item['skuid']==undefined){item['skuid']=0;}
html+='<li class="item-content">';html+='<div class="item-media">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<img class="lazyload img_square2" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';html+='</a>';html+='</div>';html+='<div class="item-inner">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div class="item-title-row">';html+='<div class="item-title color-default font7 text-overflow-line2">'+item['title']+'</div>';html+='</div>';html+='<div class="item-title-row">';html+='<div class="item-title font8 price">&#165;'+item['price'];if(item['market_price']>0){html+='<span class="market_price_wrap color-gray font6 text-delete-line">&#165;'+item['market_price']+'</span>';}
html+='</div>';html+='<div class="item-after font6 sales">';if(item['sales']>0){html+='已售'+item['sales'];}
html+='</div>';html+='</div>';html+='</a>';if(list_style_cart_btn==1){html+='<a class="button add_cart" href="#" data-itemid="'+item['id']+'" ';html+='data-skuid="'+item['skuid']+'"';html+=' data-cart-url="'+params.cart_url+'">';html+='<span class="icon iconfont">&#xe626;</span>';html+='</a>';}
html+='</div>';html+='</li>';}}else if(list_style==2){for(var i=0;i<data.length;i++){item=data[i];if(item['skuid']==undefined){item['skuid']=0;}
html+='<div class="col-50 two_list_style">';html+='<div class="card two_list_wrap">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div valign="bottom" class="card-header color-white no-border no-padding">';html+='<img class="lazyload card-cover img_square2" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';if(item['sales']>0){html+='<div class="sales_wrap">';html+='<span class="font6">已售'+item['sales']+'</span>';html+='</div>';}
html+='</div>';html+='</a>';html+='<div class="card-content">';html+='<div class="card-content-inner">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div class="text-overflow color-default">'+item['title']+'</div>';html+='</a>';html+='<div class="clearfix font7 two_list_item">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<span class="pull-left color-danger">&#165;'+item['price']+'</span>';if(item['market_price']>0){html+='<span class="market_price_wrap color-gray font6 text-delete-line">&#165;'+item['market_price']+'</span>';}
html+='</a>';if(list_style_cart_btn==1){html+='<a class="button pull-right add_cart" href="#" data-itemid="'+item['id']+'" ';html+='data-skuid="'+item['skuid']+'"';html+=' data-cart-url="'+params.cart_url+'">';html+='<span class="icon iconfont">&#xe626;</span>';html+='</a>';}
html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';}}
$('.recommend_item_list',page).append(html);initAddCart();}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={detail_url:$(t).attr('data-detail-url'),cart_url:$(t).attr('data-cart-url'),};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});var initAddCart=function(){$('.add_cart',page).unbind('click').bind('click',function(){var t=this;$(t).addClass('disabled');$.showIndicator();var itemid=$(t).attr('data-itemid');var skuid=$(t).attr('data-skuid');var postdata='itemid='+itemid+'&skuid='+skuid;var url=$(t).attr('data-cart-url');$.ajax({url:url,type:'post',data:postdata,dataType:'json',success:function(resp){$(t).removeClass('disabled');$.hideIndicator();if(resp.errno==0){$.toast('添加成功');$.updateCartCorner(page,'+',1);}else if(resp.errno==4){if(resp.errmsg){$.toast(resp.errmsg);}
setTimeout(function(){$.showIndicator();if(resp.data.url){window.location.href=resp.data.url;}else{window.location.href=window.sysinfo.loginurl;}},2000);}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});});};initAddCart();});$(document).on('pageReinit',".superpage_home",function(e,id,page){superman.log('['+id+'] pageReinit','info');loadCountdown('seckill_countdown');initRecommendItem(page);});});;$(function(){'use strict';$(document).on('pageInit',".superpage_category",function(e,id,page){superman.log('['+id+'] pageInit','info');$.wxMenu.show();var screen_height=$(window).height();var middle_height=screen_height-94;var content_height=$('.content',page).height();var left_height=$('.category_left',page).height();var right_height=$('.category_right',page).height();var lr_max_height=(left_height>right_height?left_height:right_height);var height=(content_height>lr_max_height?content_height:lr_max_height)+'px';$('.category_left',page).css('height',middle_height);$('.category_right',page).css('height',middle_height);$('.category_right_right',page).css('min-height',height);$.refreshScroller();$('.lazyload',page).picLazyLoad({element:$('.category_right',page),threshold:100});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_cart",function(e,id,page){superman.log('['+id+'] pageInit','info');var reCalcPrice=function(){var total_price=0.00,total_item=0;$('input[name=cart_id]',page).each(function(){if($(this).prop('checked')){total_item+=1;if($('.number',$(this).parent().next()).val()!==undefined){total_price+=parseFloat($(this).attr('data-price'))*parseInt($('.number',$(this).parent().next()).val());}}});total_price=total_price.formatCurrency();$('.total_price',page).html(total_price);$('.total_item',page).html(total_item);};var checkAll=function(){if($('.checkall',page).length>0){$('.checkall',page).click(function(){$.showIndicator();var t=this;var url=$(t).attr('data-url');var checked=$(this).prop('checked')?1:0;$.ajax({url:url,type:'post',data:'checkall='+checked,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno!=0){if(resp.errmsg){$.toast(resp.errmsg);}}else{$('input[type=checkbox]').prop('checked',checked);reCalcPrice();}}});});}};var deleteCart=function(){$('.delete_cart',page).click(function(){var t=this;var url=$(t).attr('data-url');var cart_ids=[],cart_selected=[];$('input[name=cart_id]').each(function(){if($(this).prop('checked')){cart_ids.push($(this).val());cart_selected.push(this);}});if(cart_ids.length<=0){$.toast('未选择商品');return;}
var buttons1=[{text:'确定要删除这'+cart_ids.length+'件商品吗？',label:true},{text:'确定',bold:true,color:'danger',onClick:function(){$.showIndicator();$.ajax({url:url,type:'post',data:'cart_ids='+cart_ids.join(','),dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast('操作成功');$(cart_selected).each(function(){var ul=$(this).parent().parent().parent();$(this).parent().parent().remove();if($('li',ul).length<=0){ul.prev().remove();}});var select_items=parseInt($('.total_item').html());$.updateCartCorner(page,'-',select_items);reCalcPrice();}else{$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}}});}}];var buttons2=[{text:'取消',bg:'danger'}];var groups=[buttons1,buttons2];$.actions(groups);});};var editCart=function(){$('.number',page).change(function(){$.showIndicator();var t=this;var url=$(t).attr('data-url');var cartid=$(t).attr('data-cartid');var total=$(t).val();$.ajax({url:url,type:'post',data:'cartid='+cartid+'&total='+total,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno!=0){if(resp.errmsg){$.toast(resp.errmsg);}}else{reCalcPrice();}}});});};var selectCartItem=function(){$('.item_checkbox',page).click(function(){$.showIndicator();var t=this;var url=$(t).attr('data-url');var cartid=$(t).attr('data-cartid');var checked=$(t).attr('data-checked')=='0'?1:0;$.ajax({url:url,type:'post',data:'cartid='+cartid+'&checked='+checked,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno!=0){if(resp.errmsg){$.toast(resp.errmsg);}}else{$(t).attr('data-checked',checked);$(t).prev().prop('checked',checked);reCalcPrice();}}});});};var plusCart=function(){$('.btn_plus',page).click(function(){var t=this;var url=$(t).attr('data-url');var cartid=$(t).attr('data-cartid');var total=$(t).prev().val();var max_total=$(t).attr('data-max-total');total=parseInt(total)+1;if(total>max_total){$.toast($(t).attr('data-title'));return false;}
$.showIndicator();$.ajax({url:url,type:'post',data:'cartid='+cartid+'&total='+total,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno!=0){if(resp.errmsg){$.toast(resp.errmsg);}}else{$(t).prev().val(total);reCalcPrice();}}});return false;});};var minusCart=function(){$('.btn_minus',page).click(function(){var t=this;var url=$(t).attr('data-url');var cartid=$(t).attr('data-cartid');var total=$(t).next().val();var min_total=$(t).attr('data-min-total');total=parseInt(total)-1;if(total<min_total){$.toast($(t).attr('data-title'));return false;}
$.showIndicator();$.ajax({url:url,type:'post',data:'cartid='+cartid+'&total='+total,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno!=0){if(resp.errmsg){$.toast(resp.errmsg);}}else{$(t).next().val(total);reCalcPrice();}}});return false;});};var initSubmitCart=function(){var obj=$('.submit_cart',page);if(obj.length){obj.click(function(){var t=this;if($(t).hasClass('disabled')){return;}
$(t).addClass('disabled');var url=$(t).attr('data-url');$.showIndicator();$.ajax({url:$(t).attr('data-url'),success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){$(t).removeClass('disabled');$.router.loadPage(resp.data.url);},2000);}}else{$(t).removeClass('disabled');$.toast(resp.errmsg);}}});});}};var initCart=function(){minusCart();plusCart();selectCartItem();checkAll();editCart();deleteCart();initSubmitCart();};initCart();});});;$(function(){'use strict';$(document).on('pageInit',".superpage_address",function(e,id,page){superman.log('['+id+'] pageInit','info');$('.delete_address',page).click(function(){var url=window.location.href;var t=this;var delete_url=$(t).attr('data-url');var buttons1=[{text:'确认删除该地址？',label:true},{text:'确认',bold:true,color:'danger',onClick:function(){$.ajax({type:'post',url:delete_url,dataType:'json',success:function(resp){if(resp.errno==0){$.toast(resp.errmsg);setTimeout(function(){window.location.href=url;},2000);}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});}}];var buttons2=[{text:'取消',bg:'danger'}];var groups=[buttons1,buttons2];$.actions(groups);return false;});$("#city-picker",page).cityPicker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">确定</button><h1 class="title">选择地区</h1></header>'});$('.set_default',page).click(function(){$.showIndicator();var t=this;var url=$(t).attr('data-url');$.ajax({type:'post',url:url,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});});$('.btn_submit',page).click(function(){$.showIndicator();var t=this;$(t).addClass('disabled').attr('disabled',true);var url=window.location.href;var token=$('input[name=token]',page).val();var username=$('input[name=username]',page).val();var mobile=$('input[name=mobile]',page).val();var city=$('input[name=city]',page).val();var address=$('textarea[name=address]',page).val();var isdefault=$('input[name=isdefault]',page).val();var data='';if(username==''){$.hideIndicator();$(t).removeClass('disabled').removeAttr('disabled');$.toast('请输入您的姓名');return false;}
if(!mobile){$.hideIndicator();$(t).removeClass('disabled').removeAttr('disabled');$.toast('请输入您的手机号');return false;}
if(mobile.search(/^([0-9]{11})?$/)==-1){$.hideIndicator();$(t).removeClass('disabled').removeAttr('disabled');$.toast('请输入正确的手机号码');return false;}
if(!city){$.hideIndicator();$(t).removeClass('disabled').removeAttr('disabled');$.toast('请选择地区');return false;}
if(address==''){$.hideIndicator();$(t).removeClass('disabled').removeAttr('disabled');$.toast('请输入详细地址');return false;}
data+='token='+token;data+='&username='+username;data+='&mobile='+mobile;data+='&city='+city;data+='&address='+address;data+='&isdefault='+isdefault;data+='&submit=yes';$.ajax({type:'post',url:url,data:data,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{$(t).removeClass('disabled').removeAttr('disabled');if(resp.errmsg){$.toast(resp.errmsg);}}}})});if($('#wechat_address_flag',page).length>0){var onBridgeReady=function(){var waf=$('#wechat_address_flag',page);var appId=waf.attr('data-appid');var addrSign=waf.attr('data-addrsign');var timeStamp=waf.attr('data-timestamp');var nonceStr=waf.attr('data-noncestr');var forward=waf.attr('data-forward');var token=waf.attr('data-token');var url=waf.attr('data-url');WeixinJSBridge.invoke('editAddress',{appId:appId,scope:'jsapi_address',signType:'sha1',addrSign:addrSign,timeStamp:timeStamp,nonceStr:nonceStr},function(res){if(res.err_msg=='edit_address:ok'){var data='';data+='token='+token;data+='&username='+res.userName;data+='&mobile='+res.telNumber;data+='&city='+res.proviceFirstStageName+' '+res.addressCitySecondStageName+' '+res.addressCountiesThirdStageName;data+='&address='+res.addressDetailInfo;data+='&isdefault=on';data+='&submit=yes';$.ajax({type:'post',url:url+'&act=post&forward='+forward,data:data,dataType:'json',success:function(resp){if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{if(resp.errmsg){$.toast(resp.errmsg);setTimeout(function(){window.location.href=url+'&wechat_addr_switch=0&forward='+forward;},2000);}}}})}else{window.location.href=url+'&forward='+forward;}});};if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener('WeixinJSBridgeReady',onBridgeReady,false);}else if(document.attachEvent){document.attachEvent('WeixinJSBridgeReady',onBridgeReady);document.attachEvent('onWeixinJSBridgeReady',onBridgeReady);}}else{onBridgeReady();}}});});;$(function(){'use strict';$(document).on('pageInit',".superpage_follow",function(e,id,page){superman.log('['+id+'] pageInit','info');function addItems(data,params){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<li>';html+='   <a href="'+params.detail_url+'&itemid='+item['id']+'" class="item-content">';html+='   <div class="item-media">';html+='       <img class="img_square1" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';html+='   </div>';html+='   <div class="item-inner">';html+='       <div class="item-title-row">';html+='           <div class="item-title color-default font7">'+item['title']+'</div>';html+='       </div>';html+='       <div class="item-text font8 color-warning">&#165;'+item['price']+'</div>';html+='   </div>';html+='   </a>';html+='</li>';}
$('.item_list ul',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={detail_url:$(t).attr('data-detail-url')};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_refund",function(e,id,page){superman.log('['+id+'] pageInit','info');$('.btn_minus').click(function(){var total=$(this).next().val();var min_total=$(this).attr('data-min-total');total=parseInt(total)-1;if(total<min_total){$.toast($(this).attr('data-title'));return false;}
$(this).next().val(total);return false;});$('.btn_plus').click(function(){var total=$(this).prev().val();var max_total=$(this).attr('data-max-total');total=parseInt(total)+1;if(total>max_total){$.toast($(this).attr('data-over-title'));return false;}
$(this).prev().val(total);return false;});var img='';var localIds;$('.add_img',page).click(function(){var t=this;if(window.sysinfo.container=='wechat'){wx.chooseImage({count:3,sizeType:['compressed'],sourceType:['album','camera'],success:function(res){localIds=res.localIds;if($.isArray(localIds)){$.each(localIds,function(key,localId){if(localId!=''){img+='<img src="'+localId+'" alt=""/>';}});$('.img_list',page).html(img);}else{$.toast('上传出错');}}});}else{$.toast('请在微信中上传图片');}});var serverId=[];var syncUpload=function(localIds){var localId=localIds.pop();wx.uploadImage({localId:localId,isShowProgressTips:0,success:function(res){serverId.push(res.serverId);if(localIds.length>0){syncUpload(localIds);}else{var str=serverId.join(',');$('#serverId',page).val(str);saveRefundInfo();}}});};var saveRefundInfo=function(){var serverId=$('input[name=serverId]',page).val();var oiid=$('input[name=oiid]',page).val();var total=$('input[name=total]',page).val();var remark=$('textarea[name=remark]',page).val();var token=$('input[name=token]',page).val();var url=window.location.href;var data='';data+='serverId='+serverId;data+='&oiid='+oiid;data+='&total='+total;data+='&remark='+remark;data+='&token='+token;data+='&submit=yes';$.ajax({type:'post',data:data,dataType:'json',url:url,success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{$('input[name=submit]',page).removeClass('disabled');$.toast(resp.errmsg);}}});};$('input[name=submit]',page).click(function(){$.showIndicator();var t=this;$(t).addClass('disabled');var total=$('input[name=total]',page).val();if(total<1){$.hideIndicator();$.toast('请选择申请商品数');$(t).removeClass('disabled');return false;}
var remark=$('textarea[name=remark]',page).val();if(remark.length<=0){$.hideIndicator();$.toast('请输入描述');$(t).removeClass('disabled');return false;}
try{if(typeof(localIds)=='undefined'){saveRefundInfo();}else{syncUpload(localIds);}}catch(e){}});$('.btn_submit',page).click(function(){var t=this;var confirm_url=$(t).attr('data-url');var buttons1=[{text:'确认完成该条售后？',label:true},{text:'确认',bold:true,color:'danger',onClick:function(){$.showIndicator();$.ajax({type:'post',url:confirm_url,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});}}];var buttons2=[{text:'取消',bg:'danger'}];var groups=[buttons1,buttons2];$.actions(groups);return false;});$('.btn_cancel',page).click(function(){var t=this;var cancel_url=$(t).attr('data-url');var buttons1=[{text:'确认取消该条售后？',label:true},{text:'确认',bold:true,color:'danger',onClick:function(){$.showIndicator();$.ajax({type:'post',url:cancel_url,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});}}];var buttons2=[{text:'取消',bg:'danger'}];var groups=[buttons1,buttons2];$.actions(groups);return false;});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_browse",function(e,id,page){superman.log('['+id+'] pageInit','info');function addItems(data,params){var html='',item;for(var i=0;i<data.length;i++){item=data[i]['item'];html+='<li>';html+='<a href="'+params.detail_url+'&itemid='+item['id']+'" class="item-content">';html+='   <div class="item-media">';html+='       <img class="img_square1" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';html+='   </div>';html+='   <div class="item-inner">';html+='       <div class="item-title-row">';html+='           <div class="item-title color-default font7">'+item['title']+'</div>';html+='       </div>';html+='       <div class="item-text font8 color-warning">&#165;'+item['price']+'</div>';html+='   </div>';html+='</a>';html+='</li>';}
$('.item_list ul',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={detail_url:$(t).attr('data-detail-url')};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_comment",function(e,id,page){superman.log('['+id+'] pageInit','info');var displayComment={init:function(){}};var postComment={init:function(){$('.stars',page).click(function(){var t=this;var star=$(t).attr('data-star');$('#score',page).val(star);for(var i=1;i<=5;i++){if(i<=star){$('#star'+i,page).html('&#xe630;');}else{$('#star'+i,page).html('&#xe631;');}}});var img='';var localIds;var imgIds=[];$('.add_img',page).click(function(){var t=this;if(window.sysinfo.container=='wechat'){wx.chooseImage({count:1,sizeType:['compressed'],sourceType:['album','camera'],success:function(res){localIds=res.localIds;if($.isArray(localIds)&&res.errMsg=='chooseImage:ok'){$.each(localIds,function(key,localId){if(imgIds.length>=5){$.toast('评论图片数不能超过5张');}else{imgIds.push(localId);if(localId!=''){img+='<div class="col-33">';img+='<span class="iconfont font9 del_img">&#xe62b;</span>';img+='<img class="card-cover" src="'+localId+'">';img+='</div>';}}});$('.img_list',page).html(img);$('.del_img',page).click(function(){$(this).parent().remove();var id=$(this).next().attr('src');var pos=-1;for(var i=0;i<imgIds.length;i++){if(imgIds[i]==id){pos=i;break;}}
if(pos>-1){imgIds.splice(pos,1);}});}else{$.toast('上传出错');}}});}else{$.toast('请在微信中上传图片');}});var saveMemberInfo=function(){var serverId=$('#serverId',page).val();var message=$('#message',page).val();var score=$('#score',page).val();var anonymous=$('#anonymous',page).prop('checked')?1:0;var token=$('input[name=token]',page).val();var url=window.location.href;$.ajax({type:'post',data:'serverId='+serverId+'&message='+message+'&score='+score+'&anonymous='+anonymous+'&token='+token+'&submit=yes',dataType:'json',url:url,success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{$('input[name=submit]',page).removeClass('disabled');$.toast(resp.errmsg);}}});};var serverId=[];var syncUpload=function(localIds){var localId=localIds.pop();wx.uploadImage({localId:localId,isShowProgressTips:0,success:function(res){serverId.push(res.serverId);if(localIds.length>0){syncUpload(localIds);}else{var str=serverId.join(',');$('#serverId',page).val(str);saveMemberInfo();}}});};$('input[name=submit]',page).click(function(){$.showIndicator();var t=this;$(t).addClass('disabled');var score=$('#score',page).val();if(score<=0){$.hideIndicator();$.toast('请选择评分');$(t).removeClass('disabled');return false;}
var message=$('#message',page).val();if(message.length>70){$.hideIndicator();$.toast('字数超过限制');$(t).removeClass('disabled');return false;}
try{if(imgIds.length==0){saveMemberInfo();}else{syncUpload(imgIds);}}catch(e){}});}};var listComment={init:function(){var addItems=function(data){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<div class="card">';html+='   <div class="card-header">';html+='       <span>';html+='           <div class="avatar_wrap">';html+='           <img src="'+item['member']['avatar']+'" onerror="this.src=\'resource/images/heading.jpg\'">';html+='           <span class="font7">'+item['member']['nickname']+'</span>';html+='           </div>';html+='       </span>';html+='       <span class="font7 color-gray">'+item['dateline']+'</span>';html+='   </div>';html+='   <div class="card-content">';html+='       <div class="star">'+item['score_html']+'</div>';html+='       <div class="card-content-inner">'+item['message']+'</div>';html+='   </div>';html+='</div>';}
$('.item_list',page).append(html);};$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){addItems(response);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});}};var albumComment={init:function(){var addItems=function(data,pageno,pagesize){var html='',item,index=0;for(var i=0;i<data.length;i++){index=(pageno*pagesize)+i;item=data[i];html+='<div class="col-33 text-center">';html+='<img src="'+tomedia(item['thumb'])+'" data-big-img="'+tomedia(item['img'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'" class="comment_img" title="'+item['message']+'" data-index="'+index+'"/>';html+='</div>';}
$('.item_list',page).append(html);$('.comment_img').unbind('click').click(function(){initPhotoBrowser(this);});};$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pagesize=$(t).attr('data-pagesize');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){addItems(response,pageno,pagesize);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});var initPhotoBrowser=function(obj){var photos=[],index=0,initialSlide=0;$('.comment_img').each(function(){var item={url:$(this).attr('data-big-img'),caption:$(this).attr('title')};if($(obj).attr('data-index')==$(this).attr('data-index')){if(initialSlide==0){initialSlide=index;}}
index+=1;photos.push(item);});var myPhotoBrowserCaptions=$.photoBrowser({photos:photos,theme:'dark',type:'popup',initialSlide:initialSlide,ofText:'/',toolbar:false});myPhotoBrowserCaptions.open();};$('.comment_img').click(function(){initPhotoBrowser(this);});}};if($('.comment_display').length>0){displayComment.init();}
if($('.comment_post').length>0){postComment.init();}
if($('.comment_list').length>0){listComment.init();}
if($('.comment_album').length>0){albumComment.init();}});});;$(function(){'use strict';$(document).on('pageInit',".superpage_list",function(e,id,page){superman.log('['+id+'] pageInit','info');$.wxMenu.show();$('.style_switch_btn',page).bind('click',function(){var key=window.sysinfo.cookie.pre+'list_style';var list_style=$('.item_list',page).attr('data-list-style');if(list_style==1){$.fn.cookie(key,'2',{expires:3650});}else{$.fn.cookie(key,'1',{expires:3650});}});$('.lazyload',page).picLazyLoad({element:$('.content',page),threshold:100});function addItems(data,params){var html='',item,checked='',price=0.00;var list_style=$('.item_list',page).attr('data-list-style');var list_style_cart_btn=$('.item_list',page).attr('data-list-style-cart-btn');if(list_style==1){for(var i=0;i<data.length;i++){item=data[i];if(item['skuid']==undefined){item['skuid']=0;}
html+='<li class="item-content">';html+='<div class="item-media">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<img class="lazyload img_square1" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';html+='</a>';html+='</div>';html+='<div class="item-inner">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div class="item-title-row">';html+='<div class="item-title color-default font7 text-overflow-line2">'+item['title']+'</div>';html+='</div>';html+='<div class="price_line_height item-subtitle color-danger font9 clearfix">';html+='&#165;'+item['price'];if(item['market_price']>0){html+='<span class="market_price_wrap color-gray font6 text-delete-line">&#165;'+item['market_price']+'</span>';}
if(item['sales']>0){html+='<span class="color-gray font6 pull-right">已售'+item['sales']+'</span>';}
html+='</div>';html+='</a>';html+='<div class="cart_line_height item-subtitle color-gray font6 clearfix">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<span class="pull-left color-gray">';if(item['comment_count']>0&&item['comment_parise_count']>0){html+='好评'+parseInt($item['comment_praise_count']/$item['comment_count']*100)+'%';}else{html+='暂无评价';}
html+='</span>';html+='</a>';if(list_style_cart_btn==1){html+='<a class="button pull-right add_cart" href="#" data-itemid="'+item['id']+'" ';html+='data-skuid="'+item['skuid']+'"';html+=' data-cart-url="'+params.cart_url+'">';html+='<span class="icon iconfont">&#xe626;</span>';html+='</a>';}
html+='</div>';html+='</div>';html+='</li>';}}else if(list_style==2){for(var i=0;i<data.length;i++){item=data[i];if(item['skuid']==undefined){item['skuid']=0;}
html+='<div class="col-50 two_list_style">';html+='<div class="card two_list_wrap">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div valign="bottom" class="card-header color-white no-border no-padding">';html+='<img class="lazyload card-cover img_square1" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';if(item['sales']>0){html+='<div class="sales_wrap">';html+='<span class="font6">已售'+item['sales']+'</span>';html+='</div>';}
html+='</div>';html+='</a>';html+='<div class="card-content">';html+='<div class="card-content-inner">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div class="text-overflow color-default">'+item['title']+'</div>';html+='</a>';html+='<div class="clearfix font7 two_list_item">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<span class="pull-left color-danger">&#165;'+item['price']+'</span>';if(item['market_price']>0){html+='<span class="market_price_wrap color-gray font6 text-delete-line">&#165;'+item['market_price']+'</span>';}
html+='</a>';if(list_style_cart_btn==1){html+='<a class="button pull-right add_cart" href="#" data-itemid="'+item['id']+'" ';html+='data-skuid="'+item['skuid']+'"';html+=' data-cart-url="'+params.cart_url+'">';html+='<span class="icon iconfont">&#xe626;</span>';html+='</a>';}
html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';}}
$('.item_list',page).append(html);initAddCart();}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={detail_url:$(t).attr('data-detail-url'),cart_url:$(t).attr('data-cart-url'),};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});var initAddCart=function(){$('.add_cart',page).unbind('click').bind('click',function(){var t=this;$(t).addClass('disabled');$.showIndicator();var itemid=$(t).attr('data-itemid');var skuid=$(t).attr('data-skuid');var postdata='itemid='+itemid+'&skuid='+skuid;var url=$(t).attr('data-cart-url');$.ajax({url:url,type:'post',data:postdata,dataType:'json',success:function(resp){$(t).removeClass('disabled');$.hideIndicator();if(resp.errno==0){$.toast('添加成功');$.updateCartCorner(page,'+',1);}else if(resp.errno==4){if(resp.errmsg){$.toast(resp.errmsg);}
setTimeout(function(){$.showIndicator();if(resp.data.url){window.location.href=resp.data.url;}else{window.location.href=window.sysinfo.loginurl;}},2000);}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});});};initAddCart();});});;$(function(){'use strict';var reCalcAmount;$(document).on('pageInit',".superpage_confirm",function(e,id,page){superman.log('['+id+'] pageInit','info');reCalcAmount=function(){var all_price=0.00,price_arr=new Array;$('.item_wrap',page).each(function(){var shopid=parseInt($(this).attr('data-shopid'));var price=parseFloat($(this).attr('data-price'));var total=parseInt($(this).attr('data-total'));if(typeof price_arr[shopid]=='undefined'){price_arr[shopid]=0;}
price_arr[shopid]+=price*total;});$('.dispatch_type',page).each(function(){var shopid=$(this).attr('data-shopid');var postage=$(this).attr('data-postage')?parseFloat($(this).attr('data-postage')):0;if(!$('#myfetchid_'+shopid).val()){if(typeof price_arr[shopid]=='undefined'){price_arr[shopid]=0;}
if($('#dispatch_type_'+shopid).attr('data-val')=='option1'){price_arr[shopid]+=postage;}}
$('#shop_allprice_'+shopid,page).html('合计：'+price_arr[shopid].formatCurrency());});$('.full_dec',page).each(function(){var shopid=$(this).attr('data-shopid');price_arr[shopid]-=parseFloat($(this).attr('data-full-dec'));});$('.cash_credit',page).each(function(){var shopid=$(this).attr('data-shopid');var cash_credit=parseFloat($(this).attr('data-cash-credit'));if($(this).attr('data-checked')=='1'){price_arr[shopid]-=cash_credit;}});$(price_arr).each(function(){all_price+=this;});$('.all_price',page).html('合计：'+all_price.formatCurrency());};reCalcAmount();$('.cash_open',page).unbind('click').click(function(){var checked=$(this).prev().attr('data-checked')=='1'?'0':'1';$(this).prev().attr('data-checked',checked);reCalcAmount();});$('.edit_idcard_btn',page).click(function(){$('input[name=idcard]',page).removeAttr('disabled');var idcard=$('input[name=idcard]',page).attr('data-idcard');$('input[name=idcard]',page).val("").focus().val(idcard);});$('#btn_submit_order',page).unbind('click').click(function(){var t=this;if($(t).hasClass('disabled')){return;}
$(t).addClass('disabled');if($(t).attr('data-unsubscribe-order')=='1'&&$(t).attr('data-subscribe-url')!=''&&$(t).attr('data-follow')=='0'){$.modal({title:'温馨提示',text:$(t).attr('data-subscribe-tips'),buttons:[{text:'点击关注',bold:true,onClick:function(){$.showIndicator();window.location.href=$(t).attr('data-subscribe-url');}}]});return;}
var url=window.location.href;var itemid=$('input[name=itemid]',page).val();var skuid=$('input[name=skuid]',page).val();var token=$('input[name=token]',page).val();var total=$('input[name=total]',page).val();var address_id=$('input[name=address_id]',page).val();var remark=$('.remark',page);var myfetchid=$('.myfetchid',page);var need_address=$(t).attr('data-need-address');var cash_credit=$('.cash_credit',page);var post_data='';var idcard=$('input[name=idcard]',page).val();if(need_address){var myfetch=1;myfetchid.each(function(){if($(this).val()==''){myfetch=0;return;}});if(address_id==''&&myfetch==0){$.toast('请添加收货地址');$(t).removeClass('disabled');return false;}
var has_dispatch=true;$('.dispatch_type',page).each(function(){if(!$(this).attr('data-val')){$.toast('请选择配送方式');$(t).removeClass('disabled');has_dispatch=false;return false;}});if(!has_dispatch){return false;}
if($('input[name=idcard]',page).length>0&&!$('input[name=idcard]',page).attr('disabled')){if(idcard==''){$.toast('请填写身份证号');$(t).removeClass('disabled');return false;}else{var reg=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;if(reg.test(idcard)===false)
{$.toast('身份证号不合法');$(t).removeClass('disabled');return false;}}}}
post_data+='itemid='+itemid;post_data+='&skuid='+skuid;post_data+='&token='+token;post_data+='&total='+total;if($('input[name=idcard]',page).length>0){if($('input[name=idcard]',page).attr('disabled')){post_data+='&idcard='+$('input[name=idcard]',page).attr('data-idcard')}else{post_data+='&idcard='+idcard;}}
post_data+='&address_id='+address_id;remark.each(function(){var shopid=$(this).attr('data-shopid');post_data+='&remark['+shopid+']='+$(this).val();});cash_credit.each(function(){var shopid=$(this).attr('data-shopid');post_data+='&cash_credit['+shopid+']='+$(this).attr('data-checked');});myfetchid.each(function(){var shopid=$(this).attr('data-shopid');post_data+='&myfetchid['+shopid+']='+$(this).val();});post_data+='&submit=yes';$.showIndicator();$.ajax({type:'post',url:url,data:post_data,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){if(resp.data.url){$.toast(resp.errmsg);setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{$(t).removeClass('disabled');if(resp.errmsg){$.toast(resp.errmsg);}}}});});});$(document).on('pageInit',".express_type_wrap",function(e,id,page){superman.log('['+id+'] pageInit','info');var shopid=$(page).attr('data-shopid');if(shopid<=0){return;}
$('#btn_save_'+shopid,page).click(function(){var dis=$('input[name=distribution_'+shopid+']:checked',page);var dispatch_type='#dispatch_type_'+shopid;var shop_postage=parseFloat($(dispatch_type).attr('data-postage'));if(dis.val()=='option1'){if(shop_postage==0){$('#dispatch_type_'+shopid).html('包邮').attr('data-val','option1');}else{$('#dispatch_type_'+shopid).html('快递 '+shop_postage.formatCurrency()).attr('data-val','option1');}}else if(dis.val()=='option2'){if($('#myfetchid_'+shopid).val()==''){$.toast('未选择自提地址');return false;}}});$('input[name=distribution_'+shopid+']',page).click(function(){var t=this;var dispatch_type='#dispatch_type_'+shopid;var shop_postage=parseFloat($(dispatch_type).attr('data-postage'));if($(t).val()=='option1'){$('#myfetchid_'+shopid).val('');$('.select_myfetch',page).hide();$('#dispatch_type_'+shopid).html('快递 '+shop_postage.formatCurrency());}else{$('.select_myfetch',page).show();var url=window.location.href;var title=[];$.ajax({type:'post',url:url,data:'shopid='+shopid+'&myfetch_list=1',dataType:'json',success:function(resp){if(resp.errno==0){title=resp.data.title;}else{if(resp.errmsg){$.toast(resp.errmsg);}}
$("#picker",page).picker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">确定</button><h1 class="title">请选择自提门店</h1>\</header>',cols:[{textAlign:'left',values:title}],onClose:function(){var myfetch=$('input[name=title]',page).val();if(myfetch!='请选择自提门店'){$('#dispatch_type_'+shopid).html('自提').attr('data-val','option2');$('.myfetch_address',page).html(resp.data.address[myfetch]);$('#myfetchid_'+shopid).val(resp.data.myfetchid[myfetch]);}}});}});}});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_creditlog",function(e,id,page){superman.log('['+id+'] pageInit','info');function addItems(data,credit_title){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<li>';html+='<a href="#" class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title-row">';html+='<div class="item-title font8 color-default creditlog_title">';if(item['remark']!=''){html+=item['remark'];}else{html+='系统操作';}
html+='</div>';html+='<div class="font8 color-danger text-strong">'+item['num']+'<span class="font6">'+credit_title+'</span></div>';html+='</div>';html+='<div class="item-subtitle font6 color-gray">'+item['createtime']+'</div>';html+='</div>';html+='</a>';html+='</li>';}
$('.item_list ul',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){addItems(response,$(t).attr('data-credit-title'));$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_pay",function(e,id,page){superman.log('['+id+'] pageInit','info');var creditPay={status:function(){return parseInt($('input[name=credit_pay]',page).attr('data-checked'));},setStatus:function(checked){$('input[name=credit_pay]',page).attr('data-checked',checked);},open:function(){if(this.status()==0){$('input[name=credit_pay]',page).trigger('click');this.setStatus(1);}},close:function(){if(this.status()==1){$('input[name=credit_pay]',page).trigger('click');this.setStatus(0);}}};var wxPay={status:function(){return parseInt($('input[name=wx_pay]',page).attr('data-checked'));},setStatus:function(checked){$('input[name=wx_pay]',page).attr('data-checked',checked);},open:function(){if(this.status()==0){$('input[name=wx_pay]',page).trigger('click');this.setStatus(1);}},close:function(){if(this.status()==1){$('input[name=wx_pay]',page).trigger('click');this.setStatus(0);}}};var cashPay={status:function(){return parseInt($('input[name=cash_pay]',page).attr('data-checked'));},setStatus:function(checked){$('input[name=cash_pay]',page).attr('data-checked',checked);},open:function(){if(this.status()==0){$('input[name=cash_pay]',page).trigger('click');this.setStatus(1);}},close:function(){if(this.status()==1){$('input[name=cash_pay]',page).trigger('click');this.setStatus(0);}}};var initBtnPay=function(page){var btnPay=$('.btn_pay',page);var wx_pay=parseInt($('input[name=wx_pay]',page).attr('data-checked'));var cash_pay=parseInt($('input[name=cash_pay]',page).attr('data-checked'));var credit_pay=parseInt($('input[name=credit_pay]',page).attr('data-checked'));if(credit_pay||wx_pay||cash_pay){btnPay.removeClass('weui_btn_disabled',page).removeAttr('disabled');}else{btnPay.addClass('weui_btn_disabled',page).attr('disabled',true);}};if($('.wx_pay',page).length>0){if($('input[name=wx_pay]',page).attr('checked')){$('.btn_pay',page).removeClass('weui_btn_disabled',page).removeAttr('disabled');$('input[name=wx_pay]',page).attr('data-checked','1');$('.btn_pay',page).attr('data-pay-type','wechat');}
$('.wx_pay',page).bind('click',function(){var checked=parseInt($(this).prev().attr('data-checked'))==1?0:1;$(this).prev().attr('data-checked',checked);if(checked){$('.btn_pay',page).attr('data-pay-type','wechat');}else{$('.btn_pay',page).attr('data-pay-type','');}
cashPay.close();initBtnPay(page);});}
if($('.cash_pay',page).length>0){if($('input[name=cash_pay]',page).attr('checked')){$('.cash_pay',page).removeClass('weui_btn_disabled',page).removeAttr('disabled');$('input[name=cash_pay]',page).attr('data-checked','0');$('.btn_pay',page).attr('data-pay-type','cash');}
$('.cash_pay',page).bind('click',function(){var checked=parseInt($(this).prev().attr('data-checked'))==1?0:1;$(this).prev().attr('data-checked',checked);if(checked){$('.btn_pay',page).attr('data-pay-type','cash');}else{$('.btn_pay',page).attr('data-pay-type','');}
$('.btn_pay',page).attr('data-credit','0');wxPay.close();creditPay.close();initBtnPay(page);});}
if($('.credit_pay',page).length>0){if($('input[name=credit_pay]',page).attr('checked')){$('.btn_pay',page).removeClass('weui_btn_disabled',page).removeAttr('disabled');$('input[name=credit_pay]',page).attr('data-checked','1');$('.btn_pay',page).attr('data-credit','1');}
$('.credit_pay',page).bind('click',function(){var checked=parseInt($(this).prev().attr('data-checked'))==1?0:1;$(this).prev().attr('data-checked',checked);if($('.btn_pay',page).attr('data-pay-type')=='cash'){$('.btn_pay',page).attr('data-pay-type','');}
$('.btn_pay',page).attr('data-credit',checked);cashPay.close();initBtnPay(page);});}
$('.btn_pay',page).click(function(){$.showIndicator();var t=this;if($(t).hasClass('disabled')){return;}
$(t).addClass('disabled');var url=window.location.href;var orderid=$('input[name=orderid]',page).val();var token=$('input[name=token]',page).val();var pay_type=$(t).attr('data-pay-type');var credit=$(t).attr('data-credit');var data='';var wx_pay=parseInt($('input[name=wx_pay]',page).attr('data-checked'));var credit_pay=parseInt($('input[name=credit_pay]',page).attr('data-checked'));var pay_price=parseFloat($(t).attr('data-pay-price'));data+='orderid='+orderid;data+='&token='+token;data+='&pay_type='+pay_type;data+='&credit='+credit;data+='&submit=yes';if(credit_pay&&!wx_pay&&pay_price<0){$.hideIndicator();$.toast('余额不足');$(t).removeClass('disabled');return false;}
$.ajax({type:'post',url:url,data:data,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);setTimeout(function(){if(resp.data.url){$.router.loadPage(resp.data.url);}else if(resp.data.redirect_url){$.showIndicator();window.location.href=resp.data.redirect_url;}},2000);}else{$(t).removeClass('disabled');$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){$.router.loadPage(resp.data.url);},2000);}}}});});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_order",function(e,id,page){superman.log('['+id+'] pageInit','info');$('.refund_btn',page).click(function(){var t=this;$(t).addClass('disabled');var orderid=$(this).attr('data-orderid');var url=$(this).attr('data-url');if(!orderid){$.toast('非法请求');$(t).removeClass('disabled');return;}
$.modal({title:'申请退款',text:'<textarea rows="3" class="font7 refund_reason" name="refund_remark" placeholder="请填写退款原因，不超过60字" maxlength="60"></textarea>',buttons:[{text:'取消',onClick:function(){$(t).removeClass('disabled');return;}},{text:'确定',onClick:function(){var remark=$('textarea[name=refund_remark]').val();if(!remark){$.toast('退款描述不能为空');$(t).removeClass('disabled');return;}
$.showIndicator();$.ajax({url:url+'&act=refund&orderid='+orderid+'&remark='+remark,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);setTimeout(function(){window.location.href=url+'&act=detail&orderid='+orderid;},2000);}else{$.toast(resp.errmsg);$(t).removeClass('disabled');}}});}}]})});var initOrderPay=function(){var obj=$('.order_pay',page);if(obj.length){obj.click(function(){var t=this;if($(t).hasClass('disabled')){return;}
$(t).addClass('disabled');var url=$(t).attr('data-url');$.showIndicator();$.ajax({url:url,dataType:'json',success:function(resp){$.hideIndicator();$(t).removeClass('disabled');if(resp.errno==0){url=url.replace('&check=yes','');$.router.load(url,true);}else{$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){$.router.load(resp.data.url,true);},2000);}}}});});}};var initOrderOperate=function(){var obj=$('.order_operate');if(obj.length){obj.click(function(){var t=this;if($(t).hasClass('disabled')){return;}
$(t).addClass('disabled');var buttons1=[{text:$(t).attr('data-title'),label:true},{text:'确认',bold:true,color:'danger',onClick:function(){$.showIndicator();$.ajax({url:$(t).attr('data-url'),success:function(resp){$.hideIndicator();$(t).removeClass('disabled');if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){$.router.load(resp.data.url,true);},2000);}}else{$.toast(resp.errmsg);}}});}}];var buttons2=[{text:'取消',bg:'danger',onClick:function(){$(t).removeClass('disabled');}}];var groups=[buttons1,buttons2];$.actions(groups);return false;});}};$('.btn_checkout',page).click(function(){$.showIndicator();var t=$(this);t.addClass('disabled').attr('disabled',true);var code=$('input[name=code]',page).val();if(code==''){$.toast('验证码不能为空');$(t).removeClass('disabled');$.hideIndicator();return;}
var orderid=t.attr('data-orderid');var url=t.attr('data-url');var data='';data+='orderid='+orderid;data+='&code='+code;$.ajax({type:'post',url:url+'&act=checkout',data:data,dataType:'json',success:function(resp){$.hideIndicator();$.toast(resp.errmsg);setTimeout(function(){window.location.href=url+'&act=detail&orderid='+orderid;},2000);}})});initOrderPay();initOrderOperate();function addItems(data,params){var html='',li,item,checked='',price=0.00;for(var i=0;i<data.length;i++){li=data[i];html+='<div class="card">';html+='<div class="card-content">';html+='<div class="list-block media-list">';html+='<ul>';html+='<li>';html+='<a href="'+params.order_url+'&act=detail&orderid='+li['id']+'&from_status='+params.status+'" class="item-link item-content '+superman.external+'" data-no-cache="true">';html+='<div class="item-inner shop_name_wrap">';html+='<span class="font8">'+li['shop']['title']+'</span>';html+='<span class="font7 pull-right color-gray">';html+=li['order_status_title']+'&nbsp;';html+='</span>';html+='</div>';html+='</a>';html+='</li>';for(var v=0;v<li['order_items'].length;v++){item=li['order_items'][v];html+='<a href="'+params.order_url+'&act=detail&orderid='+li['id']+'&from_status='+params.status+'">';html+='<li class="item-content">';html+='<div class="item-media">';html+='<img class="img_square1" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+' \'">';html+='</div>';html+='<div class="item-inner font7">';html+='<div class="item-title-row">';html+='<div class="item-title color-default">'+item['title']+'</div>';html+='</div>';html+='<div class="item-subtitle color-gray">'+item['sku']+'</div>';html+='<div class="item-subtitle color-gray">x'+item['total']+'</div>';if(li['status']>=3){html+='<span>';if(item['iscomment']){html+='<a href="'+params.comment_url+'&act=display&orderid='+li['id']+'&itemid='+item['itemid']+'" class="button button-fill button-small font6 pull-right">查看评价</a>';}else{html+='<a href="'+params.comment_url+'&act=post&orderid='+li['id']+'itemid='+item['itemid']+'" class="'+superman.external+' button button-fill button-small button-warning font6 pull-right" data-no-cache="true">评价晒单</a>';}
html+='</span>';}
html+='</div>';html+='</li>';html+='</a>';}
html+='</ul>';html+='</div>';html+='</div>';html+='<div class="card-footer">';html+='<span>';html+='<span>合计:</span>';html+='<span class="color-danger font8">&#165;'+li['price']+'</span>';html+='</span>';html+='<span>';if(li['status']==0){html+='<a href="#" data-url="'+params.pay_url+'&orderid='+li['id']+'&check=yes" class="button button-fill button-small button-success font6 pull-right order_pay">立即支付</a>';}else if(li['status']==2){if(li['pay_type']!=3){html+='<a href="#" data-url="'+params.order_url+'&act=receive&orderid='+li['id']+'" class="button button-fill button-small create-actions font6 pull-right order_operate" data-title="确认已收到商品？">确认收货</a>';}
html+='<a href="'+params.order_url+'&act=logistics&orderid='+li['id']+'" class="button button-small font6 pull-right button-dark logistics_btn" data-no-cache="true">查看物流</a>';}
html+='</span>';html+='</div>';html+='</div>';}
$('#order_list',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;var status=$(t).attr('data-status');var pay_url=$(t).attr('data-pay-url');var comment_url=$(t).attr('data-comment-url');$.ajax({url:$(t).attr('data-load-url'),data:'page='+pageno+'&status='+status,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={order_url:$(t).attr('data-order-url'),status:status,pay_url:pay_url,comment_url:comment_url};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_my",function(e,id,page){superman.log('['+id+'] pageInit','info');var onBridgeReady=function(){$('.checkout_qrcode',page).click(function(){var t=$(this);var url=t.attr('data-url');wx.scanQRCode({needResult:1,scanType:["qrCode","barCode"],success:function(res){if(res.errMsg=='scanQRCode:ok'){window.location.href=url+'&orderid='+res.resultStr;}}});});};if(typeof WeixinJSBridge=="undefined"){if(document.addEventListener){document.addEventListener('WeixinJSBridgeReady',onBridgeReady,false);}else if(document.attachEvent){document.attachEvent('WeixinJSBridgeReady',onBridgeReady);document.attachEvent('onWeixinJSBridgeReady',onBridgeReady);}}else{onBridgeReady();}
$('.shop_join_link',page).click(function(){var t=this;if($(t).hasClass('disabled')){return;}
$(t).addClass('disabled');if($(t).attr('data-subscribe-url')!=''&&$(t).attr('data-follow')==0){$(t).removeAttr('href');$.modal({title:'温馨提示',text:$(t).attr('data-subscribe-tips'),buttons:[{text:'点击关注',bold:true,onClick:function(){$.showIndicator();window.location.href=$(t).attr('data-subscribe-url');}}]});return;}});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_seckill",function(e,id,page){superman.log('['+id+'] pageInit','info');$.wxMenu.show();function addItems(data,params){var html='',item,item_url;for(var i=0;i<data.length;i++){item=data[i];item_url=params.item_url+'&itemid='+item['id'];html+='<li>';html+='<a href="'+item_url+'" class="item-content '+superman.external+'" data-no-cache="true">';html+='<div class="item-media">';html+='<img class="img_square1" src="'+item['cover']+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';html+='</div>';html+='<div class="item-inner">';html+='<div class="item-title-row">';html+='<div class="item-title color-default font7">'+item['title']+'</div>';html+='</div>';html+='<div class="item-subtitle color-danger font8">';html+='&#165;'+item['price']+' <span class="seckill_title">秒杀价</span>';html+='</div>';html+='<div class="item-subtitle color-gray font6">';html+='<div class="pull-left">';html+='<span class="text-delete-line">';html+='&#165;'+item['market_price'];html+='</span>';var timestamp=parseInt((new Date).getTime()/1000);if(item['starttime']<=timestamp&&item['sales']!='0'){html+='<span>';html+='已售'+item['sale_percent']+'%';html+='</span>';}
html+='</div>';html+='<div class="pull-right">';if(item['starttime']>timestamp){html+='<button class="button button-warning">未开始</button>';}else if(item['endtime']<timestamp){html+='<button class="button button-dark">已结束</button>';}else if(item['total']==0){html+='<button class="button button-dark">已抢完</button>';}else{html+='<button class="button button-danger">去抢购</button>';}
html+='</div>';html+='</div>';html+='</div>';html+='</a>';html+='</li>';}
$('.seckill_wrap ul').append(html);}
var loading=false;$(page).on('infinite','.infinite-scroll',function(){if(loading)return;loading=true;var t=this;var url=$(t).attr('data-url');var item_url=$(t).attr('data-item-url');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;var data='';data+='page='+pageno;$.ajax({url:url,data:data,dataType:'json',success:function(response){loading=false;if(response.length>0){var params={item_url:item_url};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll'));$('.infinite-scroll-preloader').remove();$('.nodata',page).show();}}});});});});;$(function(){'use strict';var loadCountdown=function(classname){$.timer.clear($.timer.countDownIds);if($('.countdown').length){$('.countdown').html('-时-分-秒');}
var obj=$('.'+classname);if(obj.length){obj.each(function(){var t=this;var time=parseInt($(t).attr('data-time'));if(time<((new Date).getTime()/1000)){return;}
var timerId=setInterval(function(){var ret=$.timer.run(time,t);if(!ret){$.timer.clear($(t).attr('data-timerid'));}},1000);$(t).attr('data-timerid',timerId);$.timer.countDownIds.push(timerId);});}};$(document).on('pageInit',".superpage_mgroupon",function(e,id,page){superman.log('['+id+'] pageInit','info');function addItems(data,params){var html='',item,checked='',price=0.00;for(var i=0;i<data.length;i++){item=data[i];html+='<div class="col-50 two_list_style">';html+='<a href="'+params.detail_url+'&itemid='+item['id']+'" class="'+superman.external+'" data-no-cache="true">';html+='<div class="card two_list_wrap">';html+='<div valign="bottom" class="card-header color-white no-border no-padding">';html+='<img class="card-cover img_square1" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';if(item['sales']){html+='<div class="sales_wrap">';html+='<span class="font6">已售'+item['sales']+'</span>';html+='</div>';}
html+='</div>';html+='<div class="card-content">';html+='<div class="card-content-inner">';html+='<div class="text-overflow color-default">'+item['title']+'</div>';html+='<div class="clearfix font7 two_list_item">';html+='<span class="pull-left color-danger">&#165;'+item['price']+'</span>';if(item['market_price']>0){html+='<span class="market_price_wrap color-gray font6 text-delete-line">&#165;'+item['market_price']+'</span>';}
html+='</div>';html+='<div>';html+='<span class="button button-warning font6 mgroupon_btn">';html+='<span class="iconfont font8">&#xe644;</span>';if(item['extend']['multi_member_limit']){html+=item['extend']['multi_member_limit']+'人团';}else{html+='0人团';}
html+='</span>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='</a>';html+='</div>';}
$('.item_list',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={detail_url:$(t).attr('data-detail-url')};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});var displayMgroupon={init:function(){}};var listMgroupon={init:function(){$.wxMenu.show();$.wxMenu.hideTimeline();}};var inviteMgroupon={init:function(){$.wxMenu.show();$.wxMenu.hideTimeline();loadCountdown('mgroupon_remain_time');if($('.invite_wrap',page).attr('data-show-mgroupon-rule')=='1'){$.modal({extraClass:'invite_modal_wrap',title:'拼团规则',text:$('.mgroupon_rule').html(),buttons:[{text:'关闭',bold:true}]})}}};if($('.mgroupon_display').length>0){displayMgroupon.init();}
if($('.mgroupon_list').length>0){listMgroupon.init();}
if($('.mgroupon_invite').length>0){inviteMgroupon.init();}});$(document).on('pageReinit',".superpage_mgroupon",function(e,id,page){superman.log('['+id+'] pageInit','info');loadCountdown('mgroupon_remain_time');});});;$(function(){'use strict';$(document).on('pageInit',".superpage_checkout",function(e,id,page){superman.log('['+id+'] pageInit','info');$('.btn_checkout',page).click(function(){$.showIndicator();var t=$(this);t.addClass('disabled').attr('disabled',true);var remark=$('textarea[name=remark]',page).val();var orderid=t.attr('data-orderid');var url=t.attr('data-url');var data='';data+='orderid='+orderid;data+='&remark='+remark;$.ajax({type:'post',url:url+'&act=check',data:data,dataType:'json',success:function(resp){$.hideIndicator();$.toast(resp.errmsg);setTimeout(function(){window.location.href=url+'&orderid='+orderid;},2000);}})});});});;$(function(){'use strict';$(document).on('pageInit',".superpage_shop",function(e,id,page){superman.log('['+id+'] pageInit','info');$.wxMenu.show();$('.more_activity',page).click(function(){if($('.show_more_activity',$(this).prev()).css('display')=='none'){$('.more_activity_icon',$(this)).removeClass('icon-down');$('.more_activity_icon',$(this)).addClass('icon-up');}else{$('.more_activity_icon',$(this)).removeClass('icon-up');$('.more_activity_icon',$(this)).addClass('icon-down');}
$('.show_more_activity',$(this).prev()).toggle();});$('.btn_verify',page).click(function(){var t=this;var mobile_pattern=$('select[name=countryid]').find('option:checked').attr('data-mobile-pattern');if($(t).hasClass('disabled')){return false;}
var mobile=$('input[name=mobile]',page).val();if(!mobile){$.toast('请输入手机号');return false;}
if(mobile.search(mobile_pattern)==-1){$.toast('请输入合法的手机号');return false;}
var url=$('.btn_reg',page).attr('data-url');$.showIndicator();var country_id=$('select[name=countryid]').val();var data='';data+='mobile='+mobile;data+='&country_id='+country_id;$.ajax({type:'post',url:url+'&act=smsverify',data:data,dataType:'json',success:function(resp){if(resp.errno==0){$.hideIndicator();$.toast(resp.errmsg);var timer,seconds=60;if($(t).hasClass('button-default')){$(t).removeClass('button-default').addClass('button-light disabled').html('获取验证码('+seconds+')');timer=setInterval(function(){seconds-=1;if(seconds<0){$(t).removeClass('button-light disabled').addClass('button-default').html('获取验证码');clearInterval(timer);return;}
$(t).html('获取验证码('+seconds+')');},1000);}}else{$.hideIndicator();$.toast(resp.errmsg);}}});});$('.btn_reg',page).click(function(){$.showIndicator();var t=this;var url=$(t).attr('data-url');var username=$('input[name=username]',page).val();var mobile_pattern=$('select[name=countryid]').find('option:checked').attr('data-mobile-pattern');if(username==''){$.hideIndicator();$.toast('请输入帐号');return;}
var reg=/^[a-z\d_]{4,16}$/i;var re=new RegExp(reg);if(!re.test(username)){$.hideIndicator();$.toast('请输入合法的帐号');return false;}
var password=$('input[name=password]',page).val();reg=/^\w{6,16}$/i;re=new RegExp(reg);if(!re.test(password)){$.hideIndicator();$.toast('请输入合法的密码');return false;}
var mobile=$('input[name=mobile]',page).val();if(typeof(mobile)!='undefined'){if(!mobile){$.hideIndicator();$.toast('请输入手机号');return false;}
if(mobile.search(mobile_pattern)==-1){$.hideIndicator();$.toast('请输入合法的手机号');return false;}
var checkcode=$('input[name=checkcode]',page).val();}
var countryid=$('select[name=countryid]').val();var token=$('input[name=token]',page).val();var data='';data+='token='+token;data+='&username='+username;data+='&password='+password;data+='&countryid='+countryid;if(typeof(mobile)!='undefined'){data+='&mobile='+mobile;data+='&checkcode='+checkcode;}
data+='&submit=yes';$.ajax({type:'post',url:url+'&act=reg',data:data,dataType:'json',success:function(resp){if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{$.hideIndicator();$.toast(resp.errmsg);}}})});$('.btn_join',page).click(function(){$.showIndicator();var t=this;var url=$(t).attr('data-url');var title=$('input[name=title]',page).val();if(title==''){$.hideIndicator();$.toast('请输入商户名称');return;}
var address=$('input[name=address]',page).val();if(address==''){$.hideIndicator();$.toast('请输入商户地址');return;}
var contact=$('input[name=contact]',page).val();if(contact==''){$.hideIndicator();$.toast('请输入联系人姓名');return;}
var phone=$('input[name=phone]',page).val();if(phone==''){$.hideIndicator();$.toast('请输入联系电话');return;}
var business_scope=$('input[name=business_scope]',page).val();if(business_scope==''){$.hideIndicator();$.toast('请输入经营品类');return;}
var description=$('textarea[name=description]',page).val();var token=$('input[name=token]',page).val();var countryid=$('select[name=countryid]').val();var data='';data+='token='+token;data+='&title='+title;data+='&address='+address;data+='&contact='+contact;data+='&countryid='+countryid;data+='&phone='+phone;data+='&business_scope='+business_scope;data+='&description='+description;data+='&submit=yes';$.ajax({type:'post',url:url+'&act=join',data:data,dataType:'json',success:function(resp){if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){window.location.href=resp.data.url;},2000);}}else{$.hideIndicator();$.toast(resp.errmsg);}}})});$('.lazyload',page).picLazyLoad({element:$('.content',page),threshold:100});$('.shop_map').click(function(){$.showIndicator();var url=$(this).attr('data-url');var latitude=parseFloat($(this).attr('data-latitude'));var longitude=parseFloat($(this).attr('data-longitude'));var name=$(this).attr('data-name');var address=$(this).attr('data-address');if(window.sysinfo.container=='wechat'){wx.ready(function(){setTimeout(function(){wx.openLocation({latitude:latitude,longitude:longitude,name:name,address:address,scale:14,infoUrl:url});$.hideIndicator();},500);});}else{window.location.href='http://ditu.baidu.com/mobile/webapp/search/search/qt=s&wd='+address+'&src=0/vt=map';}});if($('.shop_display',page).length){var shop_display=function(){function addItems(data,params){var html='',item,checked='',price=0.00;var list_style_cart_btn=$('.shop_item_list',page).attr('data-list-style-cart-btn');for(var i=0;i<data.length;i++){item=data[i];if(item['skuid']==undefined){item['skuid']=0;}
html+='<div class="col-50 two_list_style">';html+='<div class="card two_list_wrap">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div valign="bottom" class="card-header color-white no-border no-padding">';html+='<img class="lazyload card-cover img_square1" src="'+tomedia(item['cover'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';if(item['sales']>0){html+='<div class="sales_wrap">';html+='<span class="font6">已售'+item['sales']+'</span>';html+='</div>';}
html+='</div>';html+='</a>';html+='<div class="card-content">';html+='<div class="card-content-inner">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<div class="text-overflow color-default">'+item['title']+'</div>';html+='</a>';html+='<div class="clearfix font7 two_list_item">';html+='<a class="'+superman.external+'" href="'+params.detail_url+'&itemid='+item['id']+'" data-no-cache="true">';html+='<span class="pull-left color-danger">&#165;'+item['price']+'</span>';if(item['market_price']>0){html+='<span class="market_price_wrap color-gray font6 text-delete-line">&#165;'+item['market_price']+'</span>';}
html+='</a>';if(list_style_cart_btn==1){html+='<a class="button pull-right add_cart" href="#" data-itemid="'+item['id']+'" ';html+='data-skuid="'+item['skuid']+'"';html+=' data-cart-url="'+params.cart_url+'">';html+='<span class="icon iconfont">&#xe626;</span>';html+='</a>';}
html+='</div>';html+='</div>';html+='</div>';html+='</div>';html+='</div>';}
$('.item_list',page).append(html);initAddCart();}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={detail_url:$(t).attr('data-detail-url'),cart_url:$(t).attr('data-cart-url'),};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});var initAddCart=function(){$('.add_cart',page).unbind('click').bind('click',function(){var t=this;$(t).addClass('disabled');$.showIndicator();var itemid=$(t).attr('data-itemid');var skuid=$(t).attr('data-skuid');var postdata='itemid='+itemid+'&skuid='+skuid;var url=$(t).attr('data-cart-url');$.ajax({url:url,type:'post',data:postdata,dataType:'json',success:function(resp){$(t).removeClass('disabled');$.hideIndicator();if(resp.errno==0){$.toast('添加成功');$.updateCartCorner(page,'+',1);}else if(resp.errno==4){if(resp.errmsg){$.toast(resp.errmsg);}
setTimeout(function(){$.showIndicator();if(resp.data.url){window.location.href=resp.data.url;}else{window.location.href=window.sysinfo.loginurl;}},2000);}else{if(resp.errmsg){$.toast(resp.errmsg);}}}});});};initAddCart();}();}
if($('.shop_list',page).length){var shop_list=function(){function addItems(data,params){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<li class="shop_info">';html+='<a href="'+params.shop_url+'&shopid='+item['id']+'" class="item-content color-default '+superman.external+'" data-no-cache="true">';html+='<div class="item-media">';html+='<img class="shop_avatar img_square1" src="'+tomedia(item['logo'])+'" onerror="this.src=\''+window.sysinfo.placeholder+'\'"/>';html+='</div>';html+='<div class="item-inner">';html+='<div class="item-title-row">';html+='<div class="text-overflow">';html+='<span class="font8 text-strong shop_title">';html+=item['title'];html+='</span>';html+='</div>';html+='</div>';html+='<div class="item-title-row font7">';html+='<div class="text-overflow color-gray">';if(item['phone']){html+='<span class="iconfont color-gray font6">&#xe619;</span> '+item['phone'];}
html+='</div>';html+='<div class="item-after distance">';if(item['distance']){html+=item['distance']+'km';}
html+='</div>';html+='</div>';if(item['province']){html+='<div class="item-title-row font7">';html+='<div class="text-overflow color-gray"><span class="iconfont color-gray font6">&#xe605;</span>'+item['province']+item['city']+item['district']+item['address']+'</div>';html+='</div>';}
html+='</div>';html+='</a>';html+='</li>';if(item['activity'].length>0){html+='<div class="row no-gutter shop_discount_wrap">';if(item['activity'].length>1){html+='<div class="col-80">';}else{html+='<div class="col-100">';}
html+='<div class="shop_discount_row text-overflow color-gray">';html+='<a href="'+params.shop_url+'&shopid='+item['id']+'&activityid='+item['activity']['0']['id']+'" class="color-gray">';html+='<span class="button button-danger font6">'+item['activity'][0]['title']+'</span>';html+='<span class="font6">活动时间：'+item['activity'][0]['start']+' ~ '+item['activity'][0]['end']+'</span>';html+='</a>';html+='</div>';if(item['activity'].length>1){html+='<div class="show_more_activity">';for(var a=0;a<item['activity'].length;a++){var activity=item['activity'][a];if(a!=0){html+='<div class="shop_discount_row text-overflow color-gray">';html+='<a href="'+params.shop_url+'&shopid='+item['id']+'&activityid='+activity['id']+'" class="color-gray">';html+='<span class="button button-danger font6">'+activity['title']+'</span>';html+='<span class="font6">活动时间：'+activity['start']+' ~ '+activity['end']+'</span>';html+='</a>';html+='</div>';}}
html+='</div>';}
html+='</div>';if(item['activity'].length>1){html+='<div class="col-20 more_activity">';html+='<span class="font6 color-gray">'+item['activity'].length+'个活动</span>';html+='<span class="icon icon-down more_activity_icon font6 color-gray"></span>';html+='</div>';}
html+='</div>';}}
$('.shop_list_wrap .shop_list_ul',page).append(html);$('.more_activity',page).unbind('click').click(function(){if($('.show_more_activity',$(this).prev()).css('display')=='none'){$('.more_activity_icon',$(this)).removeClass('icon-down');$('.more_activity_icon',$(this)).addClass('icon-up');}else{$('.more_activity_icon',$(this)).removeClass('icon-up');$('.more_activity_icon',$(this)).addClass('icon-down');}
$('.show_more_activity',$(this).prev()).toggle();});}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var kw=$(t).attr('data-kw');var order_payed=$(t).attr('data-order-payed');var getlocal=$(t).attr('data-getlocal');var latitude=$(t).attr('data-latitude');var longitude=$(t).attr('data-longitude');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;var data='page='+pageno;if(kw!=''){data+='&kw='+kw;}
if(order_payed!=''){data+='&order_payed='+order_payed;}
if(getlocal!=''){data+='&getlocal='+getlocal}
if(latitude!=''){data+='&latitude='+latitude;}
if(longitude!=''){data+='&longitude='+longitude;}
$.ajax({url:$(t).attr('data-list-url'),data:data,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){var params={shop_url:$(t).attr('data-shop-url')};addItems(response,params);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});}();}});});;$(function(){'use strict';$(document).on('pageInit',".superpage_partner",function(e,id,page){superman.log('['+id+'] pageInit','info');$.wxMenu.show();var PartnerHome={init:function(){if(!$('.partner_home',page).length){return;}}};var PartnerReg={init:function(){if(!$('.partner_reg',page).length){return;}
this.btn_verify_click();this.btn_reg_click();},btn_verify_click:function(){$('.btn_verify',page).click(function(){var t=this;if($(t).hasClass('disabled')){return false;}
var realname=$('input[name=realname]',page).val();if(!realname){$.toast('请输入您的姓名');return false;}
var mobile=$('input[name=mobile]',page).val();if(!mobile){$.toast('请输入您的手机号');return false;}
if(mobile.search(/^([0-9]{11})?$/)==-1){$.toast('请输入正确的手机号码');return false;}
var timer,seconds=60;if($(t).hasClass('button-default')){$(t).removeClass('button-default').addClass('button-light disabled').html('获取验证码('+seconds+')');timer=setInterval(function(){seconds-=1;if(seconds<0){$(t).removeClass('button-light disabled').addClass('button-default').html('获取验证码');clearInterval(timer);return;}
$(t).html('获取验证码('+seconds+')');},1000);}
var url=$(t).attr('data-url');$.showIndicator();$.ajax({type:'post',url:url+'&op=smsverify',data:'mobile='+mobile,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);var timer,seconds=60;if($(t).hasClass('button-default')){$(t).removeClass('button-default').addClass('button-light disabled').html('获取验证码('+seconds+')');timer=setInterval(function(){seconds-=1;if(seconds<0){$(t).removeClass('button-light disabled').addClass('button-default').html('获取验证码');clearInterval(timer);return;}
$(t).html('获取验证码('+seconds+')');},1000);}}else{$.toast(resp.errmsg);}}});});},btn_reg_click:function(){$('.btn_reg',page).click(function(){var t=this;if($(t).hasClass('disabled')){return false;}
$(t).addClass('disabled');var realname=$('input[name=realname]',page).val();if(realname==''){$.toast('请输入您的姓名');$(t).removeClass('disabled');return;}
var mobile=$('input[name=mobile]',page).val();var checkcode=$('input[name=checkcode]',page).val();if($('input[name=mobile]',page).length>0){if(mobile==''){$.toast('请输入您的手机号');$(t).removeClass('disabled');return false;}
if(mobile.search(/^([0-9]{11})?$/)==-1){$.toast('请输入正确的手机号码');$(t).removeClass('disabled');return false;}
if(checkcode==''){$.toast('请输入验证码');$(t).removeClass('disabled');return false;}}
var fromid=$('input[name=fromid]',page).val();var data='';data+='&realname='+realname;data+='&mobile='+mobile;if(typeof(checkcode)!='undefined'){data+='&checkcode='+checkcode;}
if(typeof(fromid)!='undefined'){data+='&fromid='+fromid;}
data+='&submit=yes';var url=$(t).attr('data-url');$.showIndicator();$.ajax({type:'post',url:url,data:data,dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){$.showIndicator();window.location.href=resp.data.url;},2000);}}else{$(t).removeClass('disabled');$.toast(resp.errmsg);}}})});}};var PartnerGetcashApply={init:function(){if(!$('.partner_getcash_apply',page).length){return;}
this.btn_getcash_click();this.getcash_all_click();},btn_getcash_click:function(){$('.btn_getcash',page).click(function(){var t=$(this);if(t.hasClass('disabled')){return false;}
t.addClass('disabled');var money=$('input[name=money]',page);var min=$(money).attr('data-min');var max=$(money).attr('data-max');if(!money.val()){$.toast('提现金额不能为空');t.removeClass('disabled');return;}
if(!((/^(([1-9]\d*)|\d)(\.\d{1,2})?$/).test(money.val().toString()))){$.toast('提现金额不合法');t.removeClass('disabled');return false;}
if(money.val()<parseFloat(min)){$.toast('提现金额不能小于最低提现金额');t.removeClass('disabled');return false;}
if(money.val()>parseFloat(max)){$.toast('提现金额不能大于余额');t.removeClass('disabled');return false;}
var url=t.attr('data-url');$.showIndicator();$.ajax({type:'post',url:url,data:'money='+money.val()+'&submit=yes',dataType:'json',success:function(resp){$.hideIndicator();if(resp.errno==0){$.toast(resp.errmsg);if(resp.data.url){setTimeout(function(){$.showIndicator();window.location.href=resp.data.url;},2000);}}else{t.removeClass('disabled');$.toast(resp.errmsg);}}});})},getcash_all_click:function(){$('.getcash_all',page).click(function(){var t=$(this);var money=$('input[name=money]');var max=$(money).attr('data-max');money.val(max);});}};var PartnerGetcashDisplay={init:function(){if(!$('.partner_getcash_display',page).length){return;}
this.infinite();},infinite:function(){function addItems(data){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<li class=" item-content">';html+='<div class="item-inner">';html+='<div class="item-title-row">';html+='<div class="item-title font7">提现申请</div>';html+='<div class="item-after font7">&yen;'+item['money']+'</div>';html+='</div>';html+='<div class="item-title-row">';html+='<div class="item-title font6 color-gray">'+item['createtime']+'</div>';html+='<div class="font6 color-warning">';if(item['status']==-2||item['status']==1){html+='待打款';}
if(item['status']==-1){html+='审核失败';}
if(item['status']==0){html+='待审核';}
if(item['status']==2){html+='已打款';}
html+='</div>';html+='</div>';html+='</div>';html+='</li>';}
$('.item_list',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){addItems(response);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});}};var PartnerRanking={init:function(){if(!$('.partner_ranking',page).length){return;}
this.infinite();},infinite:function(){function addItems(data){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<div class="card">';html+='<div class="card-header row">';html+='<div class="col-15 text-center ranking_num"><span>'+item['ranking']+'</span></div>';html+='<div class="col-60 text-overflow">';html+='<img class="rankingt_avatar" src="';if(item['avatar']){html+=tomedia(item['avatar']);}else{html+='resource/images/heading.jpg';}
html+='" onerror="this.src=\'resource/images/heading.jpg\'"/>';html+=' <span class="font7">'+item['nickname']+'</span>';html+='</div>';html+='<div class="col-25 text-right font8">&yen;'+item['commission']+'</div>';html+='</div>';html+='</div>';}
$('.item_list',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){addItems(response);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});}};var PartnerOrder={init:function(){if(!$('.partner_order',page).length){return;}
this.infinite();},infinite:function(){function addItems(data){var html='',item;for(var i=0;i<data.length;i++){item=data[i];html+='<div class="list-block">';html+='<ul>';html+='<li class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title font7">订单号：'+item['ordersn']+'</div>';html+='</div>';html+='</li>';html+='<li class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title font7">订单状态</div>';html+='<div class="item-after font7">'+item['status_title']+'</div>';html+=' </div>';html+='</li>';if(item['show_express']!=0){html+='<li class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title font7">快递公司</div>';html+='<div class="item-after font7">'+item['express_title']+'</div>';html+='</div>';html+='</li>';html+='<li class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title font7">快递单号</div>';html+='<div class="item-after font7">'+item['express_no']+'</div>';html+='</div>';html+='</li>';}
html+='<li class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title font7">下单时间</div>';html+='<div class="item-after font7">'+item['createtime']+'</div>';html+='</div>';html+='</li>';html+='<li class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title font7">佣金状态</div>';if(item['commission_status']==0){html+='<div class="item-after font7">未结算</div>';}else{html+='<div class="item-after font7">已结算</div>';}
html+='</div>';html+='</li>';html+='<li class="item-content">';html+='<div class="item-inner">';html+='<div class="item-title font7">订单金额：<span class="color-danger">&yen;'+item['price']+'</span></div>';html+='<div class="item-after font7">本单奖励：<span class="color-danger">&yen;'+item['partner_commission']+'</span></div>';html+='</div>';html+='</li>';html+='</ul>';html+='</div>';}
$('.item_list',page).append(html);}
$(page).on('infinite','.infinite-scroll',function(){var t=this;if($(t).attr('data-flag')=='1'){return;}
$(t).attr('data-flag','1');var pageno=$(t).attr('data-page');pageno=parseInt(pageno)+1;$.ajax({url:$(t).attr('data-display-url'),data:'page='+pageno,dataType:'json',success:function(response){$(t).attr('data-flag','0');if(response.length>0){addItems(response);$(t).attr('data-page',pageno);$.refreshScroller();}else{$.detachInfiniteScroll($('.infinite-scroll',page));$('.infinite-scroll-preloader',page).remove();$('.nodata',page).show();}}});});}};window.PartnerPoster={init:function(){if(!$('.partner_poster',page).length){return;}
PartnerPoster.switchStyle();if(typeof(switchStyleGroups[0][0]._id)!='undefined'){PartnerPoster.loadPoster(switchStyleGroups[0][0]._id);}},switchStyle:function(){$('.style_switch',page).click(function(){$.actions(switchStyleGroups);});},updatePosterCss:function(){var poster_wrap=$('.poster_wrap',page),img_h=$('img',poster_wrap).height(),h=($('.content',page).height()-img_h)/2;poster_wrap.css({'margin-top':h+'px','margin-bottom':h+'px'});},loadPoster:function(id,curAction){var poster_wrap=$('.poster_wrap',page);if(typeof(curAction)!='undefined'){var action;for(var i=0;i<switchStyleGroups[0].length;i++){action=switchStyleGroups[0][i];if(action._id==curAction._id){action.bold=true;action.color='danger';}else{action.bold=false;action.color='';}}}
if(id==''){var img=$('img',poster_wrap);if(img.length){PartnerPoster.updatePosterCss();}else if(switchStyleGroups[0]){}}else{poster_wrap.html('');$('.msg_tips',page).show();var url=$('.content',page).attr('data-poster-img')+'&id='+id;$.ajax({url:url,success:function(resp){if(resp.errno==0){$('.msg_tips',page).hide();poster_wrap.html('<img class="poster" src="'+resp.data.imgurl+'"/>');$('img',poster_wrap).bind('load',function(){PartnerPoster.updatePosterCss();});}else{$.toast(resp.errno+':'+resp.errmsg);}}});}}};PartnerHome.init();PartnerReg.init();PartnerGetcashApply.init();PartnerGetcashDisplay.init();PartnerRanking.init();PartnerOrder.init();PartnerPoster.init();});});;$(function(){'use strict';var initImgSquare=function(page){var img_square1=$('.img_square1',page);if(img_square1.length){img_square1.css('height',img_square1.width());}
var img_square2=$('.img_square2',page);if(img_square2.length){img_square2.css('height',img_square2.width());}
var img_square3=$('.img_square3',page);if(img_square3.length){img_square3.css('height',img_square3.width());}};$(document).on('pageInit','.page',function(e,id,page){superman.log('[main] pageInit','info');$('.todo',page).click(function(){$.toast('开发中...');return false;});$('.search_button',page).click(function(){if($(this).hasClass('disabled')){return false;}
$.showIndicator();$(this).addClass('disabled');var formid=$(this).attr('data-formid');$('#'+formid).submit();});if($('.wechat_share_tips',page).length){$('.wechat_share_tips',page).bind('click',function(){$.overlay.toggle('<img class="pull-right" src="'+window.sysinfo.mobile_path+'/images/sharer.png"/>',true);});}
if($('.redirect').length){var href=$('.redirect').attr('href');if(href!=''){setTimeout(function(){$.showIndicator();window.location.href=href;},2000);}}
if(window.sysinfo.member.uid&&window.sysinfo.global_hook_url){$.ajax({type:'get',url:window.sysinfo.global_hook_url,success:function(){}});}
if(window.sysinfo.lbs==1){wx.ready(function(){var latitude=$.fn.cookie(window.sysinfo.cookie.pre+'latitude');console.log(latitude);var longitude=$.fn.cookie(window.sysinfo.cookie.pre+'longitude');console.log(longitude);if(!latitude||!longitude||window.location.href.indexOf('&location=refresh')>0){console.log('true');wx.getLocation({type:'wgs84',success:function(res){console.log(res);$.fn.cookie(window.sysinfo.cookie.pre+'latitude',res.latitude,{expire:7});$.fn.cookie(window.sysinfo.cookie.pre+'longitude',res.longitude,{expire:7});window.location.href=window.location.href.replace('&location=get','&getlocal=1').replace('&location=refresh','&getlocal=1');}});}});}
initImgSquare(page);$(page).on('infinite','.infinite-scroll',function(){initImgSquare(page);});$('.content',page).on('scroll',function(){initImgSquare(page);});$('.content',page).on('scroll',function(){if($(this).scrollTop()>100){var gotop=$('#gotop');gotop.show();if(gotop.attr('data-click')!='1'){gotop.attr('data-click','1').bind('click',function(){$('.content',page).scrollTop(0);});}}else{$('#gotop').hide();}});});$(document).on('pageReinit','.page',function(e,id,page){initImgSquare(page);});$.init();});